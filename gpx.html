<!DOCTYPE html>
<html>

<head>
	<title>GKK GPX-reader</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style>
		#map {
			height: 90%;
			width: 100%;
			padding: 4px;
			margin: 0px;
		}
		/* Remove the navbar's default margin-bottom and rounded borders */

	</style>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->
	<script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

	<link rel="stylesheet" href="https://mrmufflon.github.io/Leaflet.Elevation/example/lib/elevation/Leaflet.Elevation-0.0.2.css" />

	<script type="text/javascript" src="https://mrmufflon.github.io/Leaflet.Elevation/example/lib/elevation/Leaflet.Elevation-0.0.2.min.js"></script>
	<script type="text/javascript" src="https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/gpx.js"></script>
</head>

<body>
	<div id="map" style="display:none"></div>
	<br>
	<label class="btn btn-primary btn-block" id="bestand">
                Selecteer een GPX-bestand <input type="file" id="the-file-input" style="display: none;" accept="*.gpx">
    </label>
	<button class="btn btn-danger btn-block" style="display:none" onclick="reload()" id="reload">Een ander bestand checken</button>
	<br>
	<div class="row">
		<div class="col-md-6"><button class="btn btn-default btn-block" onclick="fiets()">Fietskaart</button></div>
		<div class="col-md-6"><button class="btn btn-default btn-block" onclick="normaal()">Normaal</button></div>
	</div>


	<script type="text/javascript">
		var map = new L.Map('map');

		function fiets() {
			var url = 'https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=7d27de9815e648cdaf3bf4dc1cf9d075',
				attr = '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
				service = new L.TileLayer(url, {
					attribution: attr
				});
			map.addLayer(service);
		}

		function normaal() {
			var url = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
				attr = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
				service = new L.TileLayer(url, {
					attribution: attr
				});
			map.addLayer(service);
		}

		var url = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
			attr = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
			service = new L.TileLayer(url, {
				attribution: attr
			});

		var el = L.control.elevation({
			position: "bottomright",
			theme: "steelblue-theme", //default: lime-theme
			width: 500,
			height: 125,
			margins: {
				top: 10,
				right: 20,
				bottom: 30,
				left: 50
			},
			useHeightIndicator: true, //if false a marker is drawn at map position
			interpolation: "linear", //see https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-area_interpolate
			hoverNumber: {
				decimalsX: 3, //decimals on distance (always in km)
				decimalsY: 0, //deciamls on height (always in m)
				formatter: undefined //custom formatter function may be injected
			},
			xTicks: undefined, //number of ticks in x axis, calculated by default according to width
			yTicks: undefined, //number of ticks on y axis, calculated by default according to height
			collapsed: true //collapsed mode, show chart on click or mouseover
		});
		el.addTo(map);

		function renderGPX(file) {

			// generate a new FileReader object
			var reader = new FileReader();

			$('#map').css('height', '90%');

			// inject an image with the src url
			reader.onload = function(event) {
				the_url = event.target.result
				var g = new L.GPX(the_url, {
					async: true,
					marker_options: {
						startIconUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-icon-start.png',
						endIconUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-icon-end.png',
						shadowUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-shadow.png'
					}
				});

				g.on('loaded', function(e) {
					map.fitBounds(e.target.getBounds());
				});
				g.on("addline", function(e) {
					el.addData(e.line);
				});
				g.addTo(map);
				map.addLayer(service);
			}

			// when the file is read it triggers the onload event above.
			reader.readAsDataURL(file);

			$('#reload').css('display', 'block');
			$('#bestand').css('display', 'none');
		}

		// handle input changes
		$("#the-file-input").change(function() {
			console.log(this.files)
			$('#map').css('display', 'block');
			// grab the first image in the FileList object and pass it to the function
			renderGPX(this.files[0])
		});

	</script>

</body>

</html>
