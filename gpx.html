<!DOCTYPE html>
<html>

<head>
	<title>GKK GPX-viewer</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style>
		html,
		body,
		#map {
			height: 94%;
			width: 100%;
			padding: 4px;
			margin: 0px;
		}
	</style>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<link rel="stylesheet" href="./leaflet/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

	<link rel="stylesheet" href="https://mrmufflon.github.io/Leaflet.Elevation/example/lib/elevation/Leaflet.Elevation-0.0.2.css" />

	<script type="text/javascript" src="./leaflet/leaflet.js"></script>
	<script type="text/javascript" src="./leaflet/elevation.js"></script>
	<script type="text/javascript" src="./leaflet/gpx.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body>
	<div id="map"></div>
	<br>
	<div id="bestand">
		<label class="btn btn-primary btn-block">Selecteer een GPX-bestand <input type="file" id="upload" style="display: none;" accept="*.gpx"></label>
		<br>
	</div>
	<div class="row" id="reload" style="display:none">
		<div class="col-md-10 col-sm-10 col-xs-10">
			<div id="status" class="alert alert-success text-center">
				<strong>Naam bestand: <span id="name"></span></strong> / Stijging: <span id="stijgen"></span>m / Daling: <span id="dalen"></span>m / Hoogteverschil: <span id="net"></span>m
			</div>
		</div>
		<div class="col-md-2 col-sm-2 col-xs-2">
			<button class="btn btn-danger btn-block alert" onclick="location.reload()">Opnieuw</button>
		</div>
	</div>
	<div class="row">
		<div class="col-md-2 col-sm-2 col-xs-2"></div>
		<div class="col-md-4 col-sm-4 col-xs-4"><button class="btn btn-default btn-block" onclick="fiets()">Fietskaart</button></div>
		<div class="col-md-4 col-sm-4 col-xs-4"><button class="btn btn-default btn-block" onclick="normaal()">Normale kaart</button></div>
		<div class="col-md-2 col-sm-2 col-xs-2"></div>
	</div>

	<br>

	<script type="text/javascript">
		var map = new L.Map('map').setView([51.05, 3.71667], 12);

		function fiets() {
			var url = 'https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=7d27de9815e648cdaf3bf4dc1cf9d075',
				attr = '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
				service = new L.TileLayer(url, {
					attribution: attr
				});
			map.addLayer(service);
		}

		function normaal() {
			var url = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
				attr = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
				service = new L.TileLayer(url, {
					attribution: attr
				});
			map.addLayer(service);
		}

		var url = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
			attr = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
			service = new L.TileLayer(url, {
				attribution: attr
			});
		map.addLayer(service);

		var scherm = $(window).width();

		var el = L.control.elevation({
			position: "bottomright",
			theme: "steelblue-theme", //default: lime-theme
			width: scherm / 2,
			height: 125,
			margins: {
				top: 10,
				right: 20,
				bottom: 30,
				left: 50
			},
			useHeightIndicator: true, //if false a marker is drawn at map position
			interpolation: "linear", //see https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-area_interpolate
			hoverNumber: {
				decimalsX: 3, //decimals on distance (always in km)
				decimalsY: 0, //deciamls on height (always in m)
				formatter: undefined //custom formatter function may be injected
			},
			xTicks: undefined, //number of ticks in x axis, calculated by default according to width
			yTicks: undefined, //number of ticks on y axis, calculated by default according to height
			collapsed: true //collapsed mode, show chart on click or mouseover
		});
		el.addTo(map);

		function renderGPX(file) {

			// generate a new FileReader object
			var reader = new FileReader();

			// inject an image with the src url
			reader.onload = function(event) {
				the_url = event.target.result
				var g = new L.GPX(the_url, {
					async: true,
					marker_options: {
						startIconUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-icon-start.png',
						endIconUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-icon-end.png',
						shadowUrl: 'https://mrmufflon.github.io/Leaflet.Elevation/example/lib/leaflet-gpx/pin-shadow.png'
					}
				});

				g.on('loaded', function(e) {
					map.fitBounds(e.target.getBounds());
					var gpx = e.target;
					document.getElementById("name").textContent = gpx.get_name();
					document.getElementById("stijgen").textContent = gpx.get_elevation_gain().toFixed(0);
					document.getElementById("dalen").textContent = gpx.get_elevation_loss().toFixed(0);
					document.getElementById("net").textContent = (gpx.get_elevation_gain() -
						gpx.get_elevation_loss()).toFixed(0);

				});
				g.on("addline", function(e) {
					el.addData(e.line);
				});
				g.addTo(map);
				map.addLayer(service);
			}

			// when the file is read it triggers the onload event above.
			reader.readAsDataURL(file);

			$('#reload').css('display', 'block');
			$('#bestand').css('display', 'none');
		}

		// handle input changes
		$("#upload").change(function() {
			console.log(this.files)
			// grab the first image in the FileList object and pass it to the function
			renderGPX(this.files[0])
		});
	</script>
</body>

</html>
