<!DOCTYPE html>
<html>

<head>
	<title>GKK Sport</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="icon" sizes="192x192" href="icon.png">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
	<link rel="stylesheet" href="vlaggen/famfamfam-flags.css">
	<script src="vlaggen/findandreplace.js"></script>

	<style>
		.iframe {
			border: none;
			height: 600px;
			width: 100%;
		}
		
		.titelgap {
			padding: 3px;
			display: inline-block;
			color: white;
			background-color: #e74c3c;
			border-style: solid;
			border-color: #e74c3c;
			border-radius: 5px;
			font-weight: 600;
		}
		/* Remove the navbar's default margin-bottom and rounded borders */
		
		.navbar {
			margin-bottom: 0;
			border-radius: 0;
		}
		/* Set height of the grid so .sidenav can be 100% (adjust as needed) */
		
		.row.content {
			height: 450px
		}
		/* Set gray background color and 100% height */
		
		.sidenav {
			padding-top: 20px;
			background-color: #f1f1f1;
			height: 100%;
		}
		/* Set black background color, white text and some padding */
		
		.navbar-brand img {
			height: 40px;
		}
		
		.navbar-brand {
			padding-bottom: 3px;
			padding-top: 6px;
		}
		
		footer {
			background-color: #555;
			color: white;
			padding: 15px;
		}
		/* On small screens, set height to 'auto' for sidenav and grid */
		
		@media screen and (max-width: 767px) {
			.sidenav {
				height: auto;
				padding: 15px;
			}
			.row.content {
				height: 2em;
			}
		}
		
		#refresh {
			display: none;
		}
	</style>
</head>

<body>

	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
				<a class="navbar-brand" href="index.html"><img src="GKK.png"></a>
			</div>
			<div class="collapse navbar-collapse" id="myNavbar">
				<ul class="nav navbar-nav">
					<li><a href="kalender.html">Tussenstand/Kalender</a></li>
					<li><a href="zwemmen.html">Zwemmen</a></li>
					<li><a href="training">Training</a></li>
					<li><a href="triathloncalc.html">Triathlon-calc</a></li>
					<li><a href="zidb.html">ZIDB</a></li>
					<li><a href="gpx.html">GPX</a></li>
					<li><a href="koers.html" class="active">Koers</a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Archief <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="tricklist.html">Tricklist</a></li>
							<li><a href="kaartregels.html">Kaartregels</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container-fluid text-center">
		<br>
		<div id="refresh" class="alert alert-danger alert-dismissable refresh">
			<div onclick="closealert();"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a></div> Deze pagina refresht zichzelf om de minuut. De data hieronder zal dus steeds up to date zijn.
		</div>
		<div id="status" class="alert alert-danger" style="display:none">
			Oeps! Deze pagina heeft een internetverbinding nodig om te werken. Controleer of je internet wel aan staat en werkt.
		</div>
		<h1><span id="wedstrijd"></span></h1>
		<br>
		<div class="well">
			<i class="fas fa-spinner fa-7x fa-spin" id="loader"></i>
			<br>
			<p><span id="nognietbezig"></span></p>
			<div id="bezig" style="display:none">
				<h3>Nog <kbd><span id="left"></span>km</kbd> tot de finish.</h3>
				<small>(herlaadt automatisch elke minuut)</small>
				<hr>
				<p id="gap1"></p>
				<p id="gap2"></p>
				<p id="gap3"></p>
				<p id="gap4"></p>
				<p id="gap5"></p>
				<hr>
				<center>
					<a id="livestream" class="btn btn-success" style="display: none; white-space: normal;" href="http://sporza.be/cm/sporza/matchcenter/mc_livestream" disabled>Zin om live te kijken? Klik hier om naar de Sporza Livestream te gaan (indien ze de rechten hebben)!</a>
				</center>
			</div>
			<div id="podium" style="display:none">
				<p>De wedstrijd is afgelopen! Bekijk hieronder het podium</p>
				<p><strong>Winnaar:</strong>
					<span id="winnaar"></span></p>
				<p><strong>Tweede:</strong>
					<span id="tweede"></span></p>
				<p><strong>Derde:</strong>
					<span id="derde"></span></p>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6 col-sm-6 col-xs-6">
				<button data-toggle="collapse" data-target="#profiel" class="btn btn-block btn-default" style="white-space: normal;" id="btnprofiel" disabled>Klik hier om het profiel van de wedstrijd te bekijken</button>
			</div>
			<div class="col-md-6 col-sm-6 col-xs-6">
				<button data-toggle="collapse" data-target="#klassement" class="btn btn-block btn-default" style="white-space: normal;">Klik hier voor de volledige stand van de Giro</button>
			</div>
		</div>

		<div id="profiel" class="collapse">
			<div id="profielgroot"></div>
			<div id="profielberg"></div>
		</div>
		<br>

		<div id="klassement" class="collapse">
			<br>
			<div class="row">
				<div class="col-md-3 col-sm-6 col-xs-12">
					<table class="table table-hover">
						<thead>
							<tr>
								<th colspan="4">ALGEMEEN</th>
							</tr>
						</thead>
						<tbody>
							<tr id="algklas0"> </tr>
							<tr id="algklas1"> </tr>
							<tr id="algklas2"> </tr>
							<tr id="algklas3"> </tr>
							<tr id="algklas4"> </tr>
							<tr id="algklas5"> </tr>
							<tr id="algklas6"> </tr>
							<tr id="algklas7"> </tr>
							<tr id="algklas8"> </tr>
							<tr id="algklas9"> </tr>
							<tr id="algklas10"> </tr>
							<tr id="algklas11"> </tr>
							<tr id="algklas12"> </tr>
							<tr id="algklas13"> </tr>
							<tr id="algklas14"> </tr>
							<tr id="algklas15"> </tr>
							<tr id="algklas16"> </tr>
							<tr id="algklas17"> </tr>
							<tr id="algklas18"> </tr>
							<tr id="algklas19"> </tr>
						</tbody>
					</table>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<table class="table table-hover">
						<thead>
							<tr>
								<th colspan="4">PUNTEN</th>
							</tr>
						</thead>
						<tbody>
							<tr id="puntklas0"> </tr>
							<tr id="puntklas1"> </tr>
							<tr id="puntklas2"> </tr>
							<tr id="puntklas3"> </tr>
							<tr id="puntklas4"> </tr>
							<tr id="puntklas5"> </tr>
							<tr id="puntklas6"> </tr>
							<tr id="puntklas7"> </tr>
							<tr id="puntklas8"> </tr>
							<tr id="puntklas9"> </tr>
							<tr id="puntklas10"> </tr>
							<tr id="puntklas11"> </tr>
							<tr id="puntklas12"> </tr>
							<tr id="puntklas13"> </tr>
							<tr id="puntklas14"> </tr>
							<tr id="puntklas15"> </tr>
							<tr id="puntklas16"> </tr>
							<tr id="puntklas17"> </tr>
							<tr id="puntklas18"> </tr>
							<tr id="puntklas19"> </tr>
						</tbody>
					</table>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<table class="table table-hover">
						<thead>
							<tr>
								<th colspan="4">BERG</th>
							</tr>
						</thead>
						<tbody>
							<tr id="bergklas0"> </tr>
							<tr id="bergklas1"> </tr>
							<tr id="bergklas2"> </tr>
							<tr id="bergklas3"> </tr>
							<tr id="bergklas4"> </tr>
							<tr id="bergklas5"> </tr>
							<tr id="bergklas6"> </tr>
							<tr id="bergklas7"> </tr>
							<tr id="bergklas8"> </tr>
							<tr id="bergklas9"> </tr>
							<tr id="bergklas10"> </tr>
							<tr id="bergklas11"> </tr>
							<tr id="bergklas12"> </tr>
							<tr id="bergklas13"> </tr>
							<tr id="bergklas14"> </tr>
							<tr id="bergklas15"> </tr>
							<tr id="bergklas16"> </tr>
							<tr id="bergklas17"> </tr>
							<tr id="bergklas18"> </tr>
							<tr id="bergklas19"> </tr>
						</tbody>
					</table>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<table class="table table-hover">
						<thead>
							<tr>
								<th colspan="4">JONGEREN</th>
							</tr>
						</thead>
						<tbody>
							<tr id="jongklas0"> </tr>
							<tr id="jongklas1"> </tr>
							<tr id="jongklas2"> </tr>
							<tr id="jongklas3"> </tr>
							<tr id="jongklas4"> </tr>
							<tr id="jongklas5"> </tr>
							<tr id="jongklas6"> </tr>
							<tr id="jongklas7"> </tr>
							<tr id="jongklas8"> </tr>
							<tr id="jongklas9"> </tr>
							<tr id="jongklas10"> </tr>
							<tr id="jongklas11"> </tr>
							<tr id="jongklas12"> </tr>
							<tr id="jongklas13"> </tr>
							<tr id="jongklas14"> </tr>
							<tr id="jongklas15"> </tr>
							<tr id="jongklas16"> </tr>
							<tr id="jongklas17"> </tr>
							<tr id="jongklas18"> </tr>
							<tr id="jongklas19"> </tr>
						</tbody>
					</table>
				</div>

			</div>
		</div>
		<br>
	</div>
	<script type='text/javascript'>
		window.addEventListener('load', function() {
			if (navigator.onLine === false) {
				$('#status').css('display', 'block');
				$('#refresh').css('display', 'none');
				$('#profiel').css('display', 'none');
				$('.well').css('display', 'none');
				console.log('offline');
			}
		});

		var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1HW4rR9Dehu2-sga989vXPxo7_KefCktLIp6Orb5DoXg/edit?usp=sharing';

		function init() {
			Tabletop.init({
				key: publicSpreadsheetUrl,
				callback: showInfo,
				simpleSheet: true
			})
		}

		function showInfo(data, tabletop) {
			$('#loader').css('display', 'none');
			if (data[0].koers != "") {
				document.getElementById("wedstrijd").innerHTML = data[1].koers;
				document.getElementById("profielgroot").innerHTML += "<br><img width='100%' src='" + data[0].kaart + "'>";
				for (i = 1; i < 5; i++) {
					document.getElementById("profielberg").innerHTML += "<br><img width='100%' src='" + data[i].kaart + "'>";
				}
				if (data[3].koers != "") {
					document.getElementById("livestream").disabled = false;
				}
				document.getElementById("btnprofiel").disabled = false;
			} else {
				document.getElementById("wedstrijd").innerHTML = "GEEN wedstrijd";
			}
			for (i = 0; i < 20; i++) {
				document.getElementById("algklas" + i).innerHTML = "<td>" + data[i].algnum + "</td><td>" + data[i].algnaam + "</td><td>" + data[i].algteam + "</td><td>" + data[i].algtijd + "</td>";
			}
			for (i = 0; i < 20; i++) {
				document.getElementById("puntklas" + i).innerHTML = "<td>" + data[i].puntnum + "</td><td>" + data[i].puntnaam + "</td><td>" + data[i].puntteam + "</td><td>" + data[i].punttijd + "</td>";
			}
			for (i = 0; i < 20; i++) {
				document.getElementById("bergklas" + i).innerHTML = "<td>" + data[i].bergnum + "</td><td>" + data[i].bergnaam + "</td><td>" + data[i].bergteam + "</td><td>" + data[i].bergtijd + "</td>";
			}
			for (i = 0; i < 20; i++) {
				document.getElementById("jongklas" + i).innerHTML = "<td>" + data[i].jongnum + "</td><td>" + data[i].jongnaam + "</td><td>" + data[i].jongteam + "</td><td>" + data[i].jongtijd + "</td>";
			}
			//Als koers afgelopen is
			if (data[0].matchstatus === "FINISHED") {
				$('#podium').css('display', 'block');
				document.getElementById("winnaar").innerHTML = data[0].gapsdescription;
				document.getElementById("tweede").innerHTML = data[1].gapsdescription;
				document.getElementById("derde").innerHTML = data[2].gapsdescription;
				console.log(data);
			} else if (data[0].matchstatus === "" || data[0].gapsname === "") { //Als de koers nog niet begonnen is
				if (data[0].koers != "") {
					document.getElementById("nognietbezig").innerHTML = "<p>De wedstrijd is nog niet bezig, kom later terug.</p>"
					console.log("nog niet bezig");
				} else {
					document.getElementById("nognietbezig").innerHTML = "<p>Er is geen noemenswaardige wedstrijd gepland vandaag!</p><br><small>(Of deze is niet ingegeven, in dat geval trek aan de oren van Simon)</small>"
				}
			} else { //Als koers bezig is	
				document.getElementById("left").innerHTML = data[0].distancetofinish;
				$('#bezig').css('display', 'block');
				$('#livestream').css('display', 'block');
				if (data[3].gapsname != "") {
					document.getElementById("gap1").innerHTML = "<p class='titelgap'>" + data[0].gapsname + "</p><br>" + data[0].gapsdescription;
					document.getElementById("gap2").innerHTML = "<p class='titelgap'>" + data[1].gapsname + "</p><strong> (op " + data[1].gapsformatted + ")</strong><br>" + data[1].gapsdescription;
					document.getElementById("gap3").innerHTML = "<p class='titelgap'>" + data[2].gapsname + "</p><strong> (op " + data[2].gapsformatted + ")</strong><br>" + data[2].gapsdescription;
					document.getElementById("gap4").innerHTML = "<p class='titelgap'>" + data[3].gapsname + "</p><strong> (op " + data[3].gapsformatted + ")</strong>";
				} else if (data[2].gapsname != "") {
					document.getElementById("gap1").innerHTML = "<p class='titelgap'>" + data[0].gapsname + "</p><br>" + data[0].gapsdescription;
					document.getElementById("gap2").innerHTML = "<p class='titelgap'>" + data[1].gapsname + "</p><strong> (op " + data[1].gapsformatted + ")</strong><br>" + data[1].gapsdescription;
					document.getElementById("gap3").innerHTML = "<p class='titelgap'>" + data[2].gapsname + "</p><strong> (op " + data[2].gapsformatted + ")</strong>";
					document.getElementById("gap4").innerHTML = "";
					console.log(data);
				} else if (data[1].gapsname != "") {
					document.getElementById("gap1").innerHTML = "<p class='titelgap'>" + data[0].gapsname + "</p><br>" + data[0].gapsdescription;
					document.getElementById("gap2").innerHTML = "<p class='titelgap'>" + data[1].gapsname + "</p><strong> (op " + data[1].gapsformatted + ")</strong>";
					document.getElementById("gap3").innerHTML = "";
					document.getElementById("gap4").innerHTML = "";
					console.log(data);
				} else if (data[0].gapsname != "") {
					document.getElementById("gap1").innerHTML = "<p class='titelgap'>" + data[0].gapsname + "</p><br>" + data[0].gapsdescription;
					document.getElementById("gap2").innerHTML = "";
					document.getElementById("gap3").innerHTML = "";
					document.getElementById("gap4").innerHTML = "";
					console.log(data);
				}
			}
			vlaggen();
		}
		window.addEventListener('DOMContentLoaded', init);

		// Localstorage voor alert
		var isshow = localStorage.getItem('isshow');
		if (isshow == null || isshow === "0") {
			$('#refresh').show();
			localStorage.setItem('isshow', 0);
		} else {
			$('#refresh').hide();
		}

		function closealert() {
			localStorage.setItem('isshow', 1);
		}

		setInterval(function() {
			location.reload();
		}, 60000);

		function vlaggen() {
			var landnaam = ["GBR", "NED", "FRA", "ITA", "IER", "AUS", "ESP", "NZL", "ECU", "CAN", "COL", "POR", "AUT", "EST", "GER", "IRL", "RUS", "BEL", "DEN", "ALB", "LUX", "SLO", "RSA", "CZE", "SUI", "USA", "ERI", "KAZ", "ENG", "NOR", "ARG", "ISR", "LAT", "BLR", "POL", "SWE", "FIN", "SVK", "UKR", "SRB", "HUN", "LTU", "BRA", "DOM", "URU", "CRC", "RWA", "JAP", "MEX", "CRO", "MDA", "SPA"];
			var vlagnaam = ["gb", "nl", "fr", "it", "ie", "au", "es", "nz", "ec", "ca", "co", "pt", "at", "ee", "de", "ie", "ru", "be", "dk", "al", "lu", "si", "za", "cz", "ch", "us", "er", "kz", "england", "no", "ar", "il", "lv", "by", "pl", "se", "fi", "sk", "ua", "rs", "hu", "lt", "br", "do", "uy", "cr", "rw", "jp", "mx", "hr", "md", "es"];
			for (i = 0; i < landnaam.length; i++) {
				var landn = "\\(+" + landnaam[i] + "\\)+";
				var vlagn = "&nbsp;<i class=\"famfamfam-flag-" + vlagnaam[i] + "\" data-toggle=\"tooltip\" data-placement=\"right\" title=\"" + landnaam[i] + "\"></i>";
				document.body.innerHTML = document.body.innerHTML.replace(new RegExp(landn, "g"), vlagn);
			}
			$(function() {
				$('[data-toggle="tooltip"]').tooltip()
			})
		}
	</script>
</body>

</html>
